config:
  allure:
    epic: demo接口
    feature: demo模块
    story: yaml数据测试输出
  request:
    env: dev.env
    headers:
    timeout: 10
    verify: False
    redirects: True
    proxies:
      http:
      https:
  module: test

test_steps:
  - name: 查询
    case_id: event_query_001
    description: 测试直接请求
    is_run:
    request:
      method: get
      url: /posts/1
      params:
      headers:
      body_type:
      body:
      files:
    setup:
      testcase:
        - case_id: event_query_002
          key: rcode
          jsonpath: $.status_code
        - event_query_002
      hooks:
      wait_time: 0
    teardown:
      sql:
      hooks:
      extract:
        - key: test
          set_type: cache
          jsonpath: $.url
      assert:
        check:
        value: ^rcode
        type: str_eq
        jsonpath: $.status_code
      wait_time: 0

  - name: 断言
    case_id: event_query_002
    description: 高级断言
    is_run:
    request:
      method: get
      url: /comments
      params:
        postId: 1
      headers:
      body_type:
      body:
      files:
    setup:
      testcase:
      wait_time: 0
    teardown:
      extract:
        - key: test
          set_type: env
          jsonpath: $.url
      assert:
        - assert 200 == pm.response.get('status_code')
        - assert 'postId' not in str(pm.response.get('content')), '没有返回content'

  - name: hooks
    case_id: event_create_003
    description: 测试hooks
    is_run:
    request:
      method: post
      url: /posts
      params:
      headers:
        Content-type: application/json; charset=UTF-8
      body_type: json
      body:
        title: foo
        body: this is a test, sum(a+b)=${sum_a_b(1,2)}
        userId: 1
      files:
    setup:
      hooks:
        - ${current_time()}
    teardown:
      hooks:
        - ${random_phone()}
      extract:
        - key: test
          set_type: global
          jsonpath: $.url
      assert: assert 200 == pm.response.get('status_code')

  # 因为是测试跳过用例，所以没写其他内容
  - name: 跳过
    case_id: event_create_004
    description: 测试跳过
    is_run: False

  - name: 自定义跳过说明的跳过
    case_id: event_create_004
    description: 测试跳过
    is_run:
      skip: True
      reason: 自定义跳过

  - name: 条件判断时跳过
    case_id: event_create_004
    description: 测试跳过
    is_run:
      skip_if:
        - ${random_phone()} == 2
        - ${timeout} == None
      reason: 条件判断为真跳过
